From 733a0c14767ad005c4c63d0a4e31c2010193c1da Mon Sep 17 00:00:00 2001
From: VsevolodSZ <vzborovsky4@gmail.com>
Date: Fri, 21 Nov 2025 03:40:17 +0400
Subject: [PATCH] Base: Webdriver false, Network fix, SDK fix

---
 .../skia_output_device_dcomp.cc               |   2 +-
 .../blink/renderer/core/frame/navigator.cc    |   7 +------
 .../modules/netinfo/network_information.cc    |  10 ++--------
 .../app/server/win/x64/updater_legacy_idl.tlb | Bin 30220 -> 30220 bytes
 .../x64/tracing_service_idl.tlb               | Bin 2732 -> 2732 bytes
 ui/gl/dc_layer_tree.cc                        |  16 ++++++++--------
 ui/gl/dc_layer_tree.h                         |   2 +-
 ui/webui/resources/tools/package.json         |   3 +++
 8 files changed, 16 insertions(+), 24 deletions(-)
 create mode 100644 ui/webui/resources/tools/package.json

diff --git a/components/viz/service/display_embedder/skia_output_device_dcomp.cc b/components/viz/service/display_embedder/skia_output_device_dcomp.cc
index 81649eb59eb71..d0127f85214d2 100644
--- a/components/viz/service/display_embedder/skia_output_device_dcomp.cc
+++ b/components/viz/service/display_embedder/skia_output_device_dcomp.cc
@@ -56,7 +56,7 @@ OutputSurface::DCSupportLevel GetDcSupportLevel() {
     Microsoft::WRL::ComPtr<IDCompositionDevice3> dcomp_device =
         gl::GetDirectCompositionDevice();
 
-    if (Microsoft::WRL::ComPtr<IDCompositionDevice5> dcomp_device5;
+    if (Microsoft::WRL::ComPtr<IDCompositionDevice2> dcomp_device5;
         SUCCEEDED(dcomp_device.As(&dcomp_device5))) {
       return OutputSurface::DCSupportLevel::kDCompDynamicTexture;
     }
diff --git a/third_party/blink/renderer/core/frame/navigator.cc b/third_party/blink/renderer/core/frame/navigator.cc
index 1a73d4a8f097f..2f6238fcd0757 100644
--- a/third_party/blink/renderer/core/frame/navigator.cc
+++ b/third_party/blink/renderer/core/frame/navigator.cc
@@ -101,12 +101,7 @@ bool Navigator::cookieEnabled() const {
 }
 
 bool Navigator::webdriver() const {
-  if (RuntimeEnabledFeatures::AutomationControlledEnabled())
-    return true;
-
-  bool automation_enabled = false;
-  probe::ApplyAutomationOverride(GetExecutionContext(), automation_enabled);
-  return automation_enabled;
+  return false;
 }
 
 String Navigator::GetAcceptLanguages() {
diff --git a/third_party/blink/renderer/modules/netinfo/network_information.cc b/third_party/blink/renderer/modules/netinfo/network_information.cc
index 976a3c8c36dbf..a3315ed23ddd7 100644
--- a/third_party/blink/renderer/modules/netinfo/network_information.cc
+++ b/third_party/blink/renderer/modules/netinfo/network_information.cc
@@ -100,14 +100,8 @@ V8ConnectionType NetworkInformation::type() const {
 }
 
 double NetworkInformation::downlinkMax() const {
-  if (RuntimeEnabledFeatures::NetInfoConstantTypeEnabled()) {
-    return std::numeric_limits<double>::infinity();
-  }
-
-  if (!IsObserving())
-    return GetNetworkStateNotifier().MaxBandwidth();
-
-  return downlink_max_mbps_;
+  // возвращаем
+  return std::numeric_limits<double>::infinity();
 }
 
 V8EffectiveConnectionType NetworkInformation::effectiveType() {
diff --git a/third_party/win_build_output/midl/chrome/updater/app/server/win/x64/updater_legacy_idl.tlb b/third_party/win_build_output/midl/chrome/updater/app/server/win/x64/updater_legacy_idl.tlb
index 6f219cfe7b2ee39489d8bb0da461c6ce312b1859..a4b15900493a0ee00e6f2a82e50f15eee32b5da6 100644
GIT binary patch
delta 44
zcmV+{0Mq}B>;a7I0k8@i0*1D;3>&lr1ONa40JFp&U<U{P|Ns9V0MC>ECLgm(C&Es5
C%n_9U

delta 44
zcmV+{0Mq}B>;a7I0k8@i0?(hb3>&lr1poj4|Fgs&U<U^P0000V0MC>ECLgm(C&Esq
CUlGRu

diff --git a/third_party/win_build_output/midl/chrome/windows_services/elevated_tracing_service/x64/tracing_service_idl.tlb b/third_party/win_build_output/midl/chrome/windows_services/elevated_tracing_service/x64/tracing_service_idl.tlb
index f86462bf5a5cb56814c4bddb21d41d59f06afc71..5080e0684654f9cd98e6009c0408f18f9318e54d 100644
GIT binary patch
delta 58
zcmV-A0LA~T6|5Doga!xz0000i0RRA#fdzmO1OWg5|NsC0|NsC0cmMzZu#?dPBa@H?
Q2$M($J_17Avxo;I12jz(Bme*a

delta 58
zcmV-A0LA~T6|5Doga(uF0|W#t0RRA#fdzmO1OWg500000|NsC0cmMzZu#?dPBa@H?
Q2$M($J_6<2vxo;I0|(j?Pyhe`

diff --git a/ui/gl/dc_layer_tree.cc b/ui/gl/dc_layer_tree.cc
index b5e8133c98fe2..40fb3460de8d6 100644
--- a/ui/gl/dc_layer_tree.cc
+++ b/ui/gl/dc_layer_tree.cc
@@ -384,9 +384,9 @@ void DCLayerTree::Initialize(
 
   hdr_metadata_helper_ = std::make_unique<HDRMetadataHelperWin>(d3d11_device_);
 
-  if (Microsoft::WRL::ComPtr<IDCompositionDevice5> dcomp_device5;
+  if (Microsoft::WRL::ComPtr<IDCompositionDevice2> dcomp_device5;
       SUCCEEDED(dcomp_device_.As(&dcomp_device5))) {
-    hr = dcomp_device5->CreateDynamicTexture(&primary_plane_surface_);
+    // hr = dcomp_device5->CreateDynamicTexture(&primary_plane_surface_);
     if (FAILED(hr)) {
       LOG(WARNING) << "Failed to create IDCompositionDynamicTexture: "
                    << logging::SystemErrorCodeToString(hr);
@@ -1365,11 +1365,11 @@ base::expected<void, CommitError> DCLayerTree::CommitAndClearPendingOverlays(
           DVLOG(1) << "Set primary_plane_surface_ damage: "
                    << overlay.damage_rect.ToString();
 
-          const RECT damage_rect =
-              gfx::ToEnclosingRect(overlay.damage_rect).ToRECT();
-          HRESULT hr = primary_plane_surface_->SetTexture(dcomp_texture.Get(),
-                                                          &damage_rect, 1);
-          CHECK_EQ(hr, S_OK);
+         // const RECT damage_rect =
+            //  gfx::ToEnclosingRect(overlay.damage_rect).ToRECT();
+          // HRESULT hr = primary_plane_surface_->SetTexture(dcomp_texture.Get(),
+                                                         // &damage_rect, 1);
+        //  CHECK_EQ(hr, S_OK);
 
           overlay.overlay_image = DCLayerOverlayImage(
               overlay.overlay_image->size(), primary_plane_surface_,
@@ -1390,7 +1390,7 @@ base::expected<void, CommitError> DCLayerTree::CommitAndClearPendingOverlays(
     // primary plane overlay to be removed from the visual tree this frame,
     // which will cause commit to happen.
     DVLOG(1) << "Reset primary_plane_surface_ damage.";
-    primary_plane_surface_->SetTexture(nullptr);
+   // primary_plane_surface_->SetTexture(nullptr);
     primary_plane_surface_serial_ = 0;
   }
 
diff --git a/ui/gl/dc_layer_tree.h b/ui/gl/dc_layer_tree.h
index c2b50ebd8cf21..e76a5088f737f 100644
--- a/ui/gl/dc_layer_tree.h
+++ b/ui/gl/dc_layer_tree.h
@@ -555,7 +555,7 @@ class GL_EXPORT DCLayerTree {
 
   // If supported, a surface that is updated with the contents of the primary
   // plane. If not supported, null.
-  Microsoft::WRL::ComPtr<IDCompositionDynamicTexture> primary_plane_surface_;
+  Microsoft::WRL::ComPtr<IDCompositionTexture> primary_plane_surface_;
 
   // This is a number that increments once every time `primary_plane_surface_`
   // is updated, and is used to determine when the contents have changed so
diff --git a/ui/webui/resources/tools/package.json b/ui/webui/resources/tools/package.json
new file mode 100644
index 0000000000000..aead43de364cd
--- /dev/null
+++ b/ui/webui/resources/tools/package.json
@@ -0,0 +1,3 @@
+{
+  "type": "module"
+}
\ No newline at end of file
-- 
2.49.0.windows.1

